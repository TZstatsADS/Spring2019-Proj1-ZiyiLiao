---
title: "Project 1"
author: "Ziyi Liao "
output: html_notebook
---

# Preprocess the data
## Step 0: load the libraries 
```{r load libraries, warning=FALSE, message=FALSE}
library(tidyverse)
library(tidytext)
library(DT)
library(scales)
library(wordcloud2)
library(gridExtra)
library(ngram)
library(shiny) 
```
```{r other libraries, warning = FALSE, message =FALSE}
library(SnowballC)
library(wordcloud)
library(tm)
library(topicmodels)
library(RColorBrewer)
library(dplyr)

library(leaflet)
```

##Step 1:
```{r}
hm_data <- read_csv("../output/processed_moments.csv")

urlfile<-'https://raw.githubusercontent.com/rit-public/HappyDB/master/happydb/data/demographic.csv'
demo_data <- read_csv(urlfile)

happydb <- hm_data %>%
  inner_join(demo_data, by = "wid") %>%
  select(wid,
         original_hm,
         gender, 
         marital, 
         parenthood,
         reflection_period,
         age, 
         country, 
         ground_truth_category, 
         text) %>%
  mutate(count = sapply(hm_data$text, wordcount)) %>%
  filter(gender %in% c("m", "f")) %>%
  filter(marital %in% c("single", "married")) %>%
  filter(parenthood %in% c("n", "y")) %>%
  filter(reflection_period %in% c("24h", "3m")) %>%
  mutate(reflection_period = fct_recode(reflection_period, 
                                        months_3 = "3m", hours_24 = "24h"))
```



## Merge the text data with demographic data into a CSV file
```{r}
write_csv(happydb, "../output/happydb.csv")
```
convert the structures of some variables
```{r}
happydb$age <- as.numeric(happydb$age)
```



### Description
```{r hmid/wid}
length(unique(hm_data$hmid))
length(unique(hm_data$wid))
length(unique(happydb$wid))
length(unique(hm_data$hmid))/length(unique(hm_data$wid))
```
All we have 10841 people sharing 100392 happy moments. On average, the each person shared 9.26 moments.


##Step 1: Seperate the data set
```{r}
female <- happydb %>%
  filter(gender == 'f') 
male <- happydb %>%
  filter(gender == 'm')
```


##Step 2 : WordCloud of Part of Speech
1.read the senselabe file
```{r}
urlfile<-'https://raw.githubusercontent.com/rit-public/HappyDB/master/happydb/data/senselabel.csv'
sense_data <- read_csv(urlfile)
```
```{r warning=FALSE}
#merge the data with lower case word
# what's the most frequently used POS in the top freq words?
head(freq_f)
f_POS <- merge(freq_f,sense,by.x = 'word',by.y = 'lowercaseLemma')
f_POS <- as.matrix(table(f_POS$POS))

m_POS <- merge(freq_m,sense,by.x = 'word',by.y = 'lowercaseLemma')
m_POS <- as.matrix(table(m_POS$POS))
POS <- rbind(m_POS,f_POS)
POS <- data_frame(word = rownames(POS), nums= POS, gender = c(rep('male',12),rep('female',12)))
POS
  labs(title = 'POS of different gender', x = 'Part of Speech', y = 'Frequency')
levels(factor(POS$gender))

ggplot(POS, fill = 'pink')+
  geom_bar(aes(x = POS$word, y = POS$nums), stat="identity", fill = 'lightgreen') +
  facet_grid(~gender)+
  labs(titile = 'POS for different gender', x = 'Part of Speech', y = 'Frequency')

```
The result shows that both male and female like use nouns and adjs to express the happy moments.

##Step 3: WordCloud of text word
```{r reorganize data, warning=FALSE}
female_corpus <- Corpus(VectorSource(female$text))
female_dtm <- DocumentTermMatrix(female_corpus)
freq_f <- data.frame(sort(colSums(as.matrix(female_dtm)), decreasing =TRUE))
freq_f <- data.frame(word = rownames(freq_f), Freq = freq_f[,1])

male_corpus <- Corpus(VectorSource(male$text))
male_dtm <- DocumentTermMatrix(male_corpus)
freq_m <- data.frame(sort(colSums(as.matrix(male_dtm)), decreasing =TRUE))
freq_m <- data.frame(word = rownames(freq_m), Freq = freq_m[,1])
```
```{r barplot}
# most frequently used 10 words for female
ggplot(freq_f[1:10,], aes(fill = freq_f[1:10,]$word)) +
  geom_bar(aes(x = freq_f[1:10,]$word, y = freq_f[1:10,]$Freq), stat="identity", fill = 'pink')+
  labs(title='Most Frequently Used 10 Words For Female', y = 'Frequency', x = 'Words')
# most frequently used 10 words for male
ggplot(freq_m[1:10,], aes(fill = freq_m[1:10,]$word)) +
  geom_bar(aes(x = freq_m[1:10,]$word, y = freq_m[1:10,]$Freq), stat="identity", fill = 'skyblue')+
  labs(title='Most Frequently Used 10 Words For Mmale', y = 'Frequency', x = 'Words')
```
```{r wordcloud}
colorVec_f = rep(c('red', 'lightpink'), length.out=nrow(freq_f))
wordcloud2(freq_f[1:400,], color = colorVec_f, fontWeight = "bold",size=0.5, shape = 'cardioid', rotateRatio = 0.2)

colorVec_m = rep(c('blue', 'skyblue'), length.out=nrow(freq_m))
wordcloud2(freq_m[1:400,], color = colorVec_m, fontWeight = "bold",size=0.5, shape = 'star', rotateRatio = 0.2)
```

In the barplot and wordcloud graphs of both female and male, we can find that both women and men are enjoyed the happy moments with their friends. And women tend to be more bond with people around them for the words like husband, daughter, son, family come up more frequently than men's.

##Step 4: Periods


